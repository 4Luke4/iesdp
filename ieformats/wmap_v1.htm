<html>
<head>
<link rel="stylesheet" type="text/css" href="general.css" />
</head>
<body>
<div class="title_main">WMAP file format</div>
<br />
<div class="fileheader">Applies to:</div>
<div class="indent1">BG1, BG1: TotS, BG2, BG2: ToB, PST, IWD, IWD:HoW, IWD:TotL, IWD2</div><br />

<div class="fileheader">General Description</div>
<div class="indent1">
The WMAP format describes the top-level map structure of the game. It details the x/y coordinate location of areas, the graphics to represent the area on the map (both <a href="mos_v1.htm"> MOS </a> and <a href="bam_v1.htm"> BAM </a>), and also stores flag information used to decide how the map icon is displayed (visable, reachable, already visited etc.)<br />
The areas may be also put on the worldmap in ToB using specified 2DA files:<br />
<div class="indent1">
  <li><a href="../2da/2da_tob/xnewarea.htm">XNEWAREA.2DA</a> (Area entries section of wmp )</li>
  <li>2DA file specified in <a href="../2da/2da_tob/xnewarea.htm">XNEWAREA.2DA</a> (Area links section) for example XL3000.2DA</li>
</div>
<br />
NB. A WMP file must have at least one area entry, and one area link to be considered valid.
</div>
<br />

<div class="fileheader">Detailed Description</div>
<div class="indent1">
Overall structure<br />
<div class="indent1">
  <li><a href="#wmapv1_0_Header">Header</a>
  <li><a href="#wmapv1_0_Entry">Worldmap entries</a>
  <li><a href="#wmapv1_0_Area">Area entries</a>
  <li><a href="#wmapv1_0_AreaLink">Area link entries</a></li>
</div>
</div>
<br />

<div class="fileheader"><a name="wmapv1_0_Header">WMAP V1.0 Header</a></div><br />
<div class="indent1">
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (datatype)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>4 (char array)</td>
      <td>Signature ('WMAP')</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>4 (char array)</td>
      <td>Version ('V1.0')</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>4 (dword)</td>
      <td>Count of <a href="#wmapv1_0_Entry">worldmap entries</a>.</td>
    </tr>
    <tr>
      <td>0x000c</td>
      <td>4 (dword)</td>
      <td>Offset of <a href="#wmapv1_0_Entry">worldmap entries</a> from
        start of file.</td>
    </tr>
  </tbody>
</table>
</div>
<br />

<div class="fileheader"><a name="wmapv1_0_Entry">WMAP V1.0 Worldmap entry</a></div><br />
<div class="indent1">
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (datatype)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>8 (resref)</td>
      <td>Map resource name (i.e. <a href="mos_v1.htm"> MOS file</a> for background graphics of this
        worldmap).</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>4 (dword)</td>
      <td>Width</td>
    </tr>
    <tr>
      <td>0x000c</td>
      <td>4 (dword)</td>
      <td>Height</td>
    </tr>
    <tr>
      <td>0x0010</td>
      <td>4 (dword)</td>
      <td>Map number</td>
    </tr>
    <tr>
      <td>0x0014</td>
      <td>4 (strref)</td>
      <td>Area name<td>
    </tr>
    <tr>
      <td>0x0018</td>
      <td>4 (dword)</td>
      <td><div class="unknown">Unknown</div></td>
    </tr>
    <tr>
      <td>0x001c</td>
      <td>4 (dword)</td>
      <td><div class="unknown">Unknown</div></td>
    </tr>
    <tr>
      <td>0x0020</td>
      <td>4 (dword)</td>
      <td>Count of <a href="#wmapv1_0_Area">area entries</a> in this
        worldmap.</td>
    </tr>
    <tr>
      <td>0x0024</td>
      <td>4 (dword)</td>
      <td>Offset of first <a href="#wmapv1_0_Area">area entry</a> for this
        worldmap.</td>
    </tr>
    <tr>
      <td>0x0028</td>
      <td>4 (dword)</td>
      <td>Offset of first <a href="#wmapv1_0_AreaLink">area link entries</a> in
        this worldmap.</td>
    </tr>
    <tr>
      <td>0x002c</td>
      <td>4 (dword)</td>
      <td>Count of <a href="#wmapv1_0_AreaLink">area link entries</a>
        for this worldmap.</td>
    </tr>
    <tr>
      <td>0x0030</td>
      <td>8 (resref)</td>
      <td>Map icons <a href="bam_v1.htm"> BAM file</a>.</td>
    </tr>
    <tr>
      <td>0x0038</td>
      <td>128 (bytes)</td>
      <td><span class="unknown">Unknown, unused</span></td>
    </tr>
  </tbody>
</table>
</div>
<br />

<div class="fileheader"><a name="wmapv1_0_Area">WMAP V1.0 Area entry</a></div><br />
<div class="indent1">
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (datatype)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>8 (resref)</td>
      <td>Name of this area (as referenced by area links?)</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>8 (resref)</td>
      <td><a href="are_v1.htm"> AREA</a> resref for this area
    <tr>
      <td>0x0010</td>
      <td>32 (char array)</td>
      <td>Area long name (not used in-game)</td>
    </tr>
    <tr>
      <td>0x0030</td>
      <td>4 (dword)</td>
      <td>Bitmask indicating status of area:
         <div class="indent1">
          <li>bit 0: Area visible</li>
          <li>bit 1: Area visible from adjacent</li>
          <li>bit 2: Reachable</li>
          <li>bit 3: Already visited</li>
          <li><span class="unknown">bits 4-31: Unused</span></li>
        </div>
      </td>
    </tr>
    <tr>
      <td>0x0034</td>
      <td>4 (dword)</td>
      <td>Sequence within <a href="bam_v1.htm"> BAM file</a> for the icons for this area.</td>
    </tr>
    <tr>
      <td>0x0038</td>
      <td>4 (dword)</td>
      <td>X coordinate of area on world map</td>
    </tr>
    <tr>
      <td>0x003c</td>
      <td>4 (dword)</td>
      <td>Y coordinate of area on world map</td>
    </tr>
    <tr>
      <td>0x0040</td>
      <td>4 (strref)</td>
      <td>Name of this location (caption)</td>
    </tr>
    <tr>
      <td>0x0044</td>
      <td>4 (strref)</td>
      <td>Name of this location (tooltips)</td>
    </tr>
    <tr>
      <td>0x0048</td>
      <td>8 (resref)</td>
      <td>Loading screen <a href="mos_v1.htm"> MOS file</a>.</td>
    </tr>
    <tr>
      <td>0x0050</td>
      <td>4 (dword)</td>
      <td>Index of the first entry in the first group (North) of area links <em>from</em>
        this area.</td>
    </tr>
    <tr>
      <td>0x0054</td>
      <td>4 (dword)</td>
      <td>Count of entries in the first group (North) of area links <em>from</em>
        this area.</td>
    </tr>
    <tr>
      <td>0x0058</td>
      <td>4 (dword)</td>
      <td>Index of the first entry in the second group (West) of area links <em>from</em>
        this area.</td>
    </tr>
    <tr>
      <td>0x005c</td>
      <td>4 (dword)</td>
      <td>Count of entries in the second group (West) of area links <em>from</em>
        this area.</td>
    </tr>
    <tr>
      <td>0x0060</td>
      <td>4 (dword)</td>
      <td>Index of the first entry in the third group (South) of area links <em>from</em>
        this area.</td>
    </tr>
    <tr>
      <td>0x0064</td>
      <td>4 (dword)</td>
      <td>Count of entries in the third group (South) of area links <em>from</em>
        this area.</td>
    </tr>
    <tr>
      <td>0x0068</td>
      <td>4 (dword)</td>
      <td>Index of the first entry in the fourth group (East) of area links <em>from</em>
        this area.</td>
    </tr>
    <tr>
      <td>0x006c</td>
      <td>4 (dword)</td>
      <td>Count of entries in the fourth group (East) of area links <em>from</em>
        this area.</td>
    </tr>
    <tr>
      <td>0x0070</td>
      <td>128 (bytes)</td>
      <td><span class="unknown">Unknown, unused</span></td>
    </tr>
  </tbody>
</table>
</div>
<br />

<div class="fileheader"><a name="wmapv1_0_AreaLink">WMAP V1.0 Area Link entry</a></div><br />
<div class="indent1">
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (datatype)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>4 (dword)</td>
      <td>Index of destination area</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>32 (char array)</td>
      <td>Name of entry point in destination area</td>
    </tr>
    <tr>
      <td>0x0024</td>
      <td>4 (dword)</td>
      <td>Travel time / 4</td>
    </tr>
    <tr>
      <td>0x0028</td>
      <td>4 (dword)</td>
      <td>Default entry location
        <div class="indent1">
          0x01 - Move to northern side of target area<br />
          0x02 - Move to eastern side of target area<br />
          0x04 - Move to southern side of target area<br />
          0x08 - Move to western side of target area<br />
        </div>
      </td>
    </tr>
    <tr>
      <td>0x002c</td>
      <td>8 (resref)</td>
      <td>Area of random encounter (ENCOUNTER0)</td>
    </tr>
    <tr>
      <td>0x0034</td>
      <td>8 (resref)</td>
      <td>Area of random encounter (ENCOUNTER1)</td>
    </tr>
    <tr>
      <td>0x003c</td>
      <td>8 (resref)</td>
      <td>Area of random encounter (ENCOUNTER2)</td>
    </tr>
    <tr>
      <td>0x0044</td>
      <td>8 (resref)</td>
      <td>Area of random encounter (ENCOUNTER3)</td>
    </tr>
    <tr>
      <td>0x004c</td>
      <td>8 (resref)</td>
      <td>Area of random encounter (ENCOUNTER4)</td>
    </tr>
    <tr>
      <td>0x0054</td>
      <td>4 (dword)</td>
      <td>Probability of a random encounter</td>
    </tr>
    <tr>
      <td>0x0028</td>
      <td>128 (bytes)</td>
      <td><div class="unknown">Unknown</div></td>
    </tr>
  </tbody>
</table>
</div>
</body>
</html>
