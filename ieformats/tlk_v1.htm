<html>
<head>
<link rel="stylesheet" type="text/css" href="general.css" />
</head>
<body>
<div class="title_main">TLK file format</div>
<br />
<div class="fileheader">Applies to:</div>
<div class="indent1">BG1, BG1: TotS, BG2, BG2: ToB, PST, IWD, IWD:HoW, IWD:TotL, IWD2</div><br />
<br />

<div class="fileheader">General Description</div>
<div class="indent1">
Each Infinity Engine game has at least one TLK file with it. Only one of
these files will be used at a time. These files contain several strings (with
some associated information) which are looked up by a 32-bit identifier called a
&quot;Strref&quot; (String Reference). If the designer wishes to replace all the
dialog (for instance, to translate to another language), it is a very simple
matter of replacing just one file, (sound files not included). Anyway, this is a
very straightforward file format. To find a particular string, use the Strref as
a 0-based index into the table of entries.<br />
According to the BioWare developers this kind of file was named there as
&quot;Talk Table&quot;<br />
</div>
<br />

<div class="fileheader">Detailed Description</div>
<div class="indent1">
Overall structure<br />
<div class="indent1">
  <li><a href="#tlkv1_Header">Header</a>
  <li><a href="#tlkv1_Entry">Entries</a>
  <li><a href="#tlkv1_Strings">Strings section</a></li>
</div>
</div>
<br />

<div class="fileheader"><a name="tlkv1_Header">TLK V1 Header</div>
<div class="indent1">
<br />
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (data type)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>4 (char array)</td>
      <td>Signature ('TLK ')</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>4 (char array)</td>
      <td>Version ('V1 ')</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>2 (word)</td>
      <td>Language ID</td>
    </tr>
    <tr>
      <td>0x000a</td>
      <td>4 (dword)</td>
      <td>Number of <a href="#tlkv1_Entry">Strref entries</a> in this file.</td>
    </tr>
    <tr>
      <td>0x000e</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#tlkv1_Strings">string data</a></td>
    </tr>
  </tbody>
</table>
</div>
<br />

<div class="fileheader"><a name="tlkv1_Entry">TLK V1 Entries</div>
<div class="indent1">
<br />
This section is hardcoded to start at byte 18 from the beginning of the file.
The string offsets are relative to the strings section.<br />
<br />
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (data type)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>2 (word)</td>
      <td>
        <ul>
          <li>00 - No message data</li>
          <li>01 - Text exists</li>
          <li>02 - Sound exists</li>
          <li>03 - Standard message. Ambient message. Used for sound without text (BG1) or message
            displayed over characters head (BG2) , Message with tags (for instance &lt;CHARNAME&gt;
            ) for all games except BG2</li>
          <li>07 - Message with tags (for instance &lt;CHARNAME&gt; ) in BG2
            only</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td>0x0002</td>
      <td>8 (resref)</td>
      <td>Resource name of the associated sound, if any</td>
    </tr>
    <tr>
      <td>0x000a</td>
      <td>4 (dword)</td>
      <td>Volume variance.</td>
    </tr>
    <tr>
      <td>0x000e</td>
      <td>4 (dword)</td>
      <td>Pitch variance.</td>
    </tr>
    <tr>
      <td>0x0012</td>
      <td>4 (dword)</td>
      <td>Offset of this string relative to the <a href="#tlkv1_Strings">strings
        section</a></td>
    </tr>
    <tr>
      <td>0x0016</td>
      <td>4 (dword)</td>
      <td>Length of this string</td>
    </tr>
  </tbody>
</table>
</div>
<br />

<div class="fileheader"><a name="tlkv1_Strings">TLK V1 Strings</div>
<div class="indent1">
<br />
This section is entirely composed of ASCII strings. They contain no terminator
character. It is assumed they may contain a NUL where the string will be stopped
displayed, but this feature is useless and unused. The sound reference may contain a NUL terminator though.
All the indexing for these strings is done in the <a name="tlkv1_Entry">strref entries</a> section.
</div>
</body>
</html>
