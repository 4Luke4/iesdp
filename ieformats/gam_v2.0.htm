<html>
<head>
<link rel="stylesheet" type="text/css" href="general.css" />
</head>
<body>
<div class="title_main">GAM file format</div>
<br />
<div class="fileheader">Applies to:</div>
<div class="indent1"> BG2, BG2: ToB</div>
<br />

<div class="fileheader">General Description</div>
<div class="indent1">
This format is used for the save game files. It doesn't store area specific
information. Instead, it stores information on the party members and the global
variables which affect the party members.<br />
</div>

<br />
<div class="fileheader">Detailed Description</div>
<div class="indent1">
Overall structure:<br />
<div class="indent1">
  <li><a href="#GAMEV2_0_Header">Header</a>
  <li><a href="#GAMEV2_0_NPC">Party members</a>
  <li>Party member CRE file data
  <li><a href="#GAMEV2_0_NPC">NPCs (who are not in the party)</a>
  <li><a href="#GAMEV2_0_Stats">NPC kills statistics (embedded in NPC struct)</a>
  <li>NPC CRE file data
  <li><a href="#GAMEV2_0_Variable">Variables (in the GLOBAL namespace)</a>
  <li><a href="#GAMEV2_0_Journal">Journal entries</a>
  <li><a href="#GAMEV2_0_Familiar">Familiar info</a>
  <li><a href="#GAMEV2_0_Stored">Stored Locations info</a>
</div>
</div>

<br />
<div class="fileheader"><a name="GAMEV2_0_Header">GAME V2.0 Header</a></div>
<br />
<div class="indent1">
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (datatype)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>4 (char array)</td>
      <td>Signature ('GAME')</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>4 (char array)</td>
      <td>Version ('V2.0')</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>4 (dword)</td>
      <td>Game time (300 units == 1 hour).</td>
    </tr>
    <tr>
      <td>0x000c</td>
      <td>2 (word)</td>
      <td>Selected Formation</td>
    </tr>
    <tr>
      <td>0x000e</td>
      <td>2 (word)</td>
      <td>Formation button 1</td>
    </tr>
    <tr>
      <td>0x0010</td>
      <td>2 (word)</td>
      <td>Formation button 2</td>
    </tr>
    <tr>
      <td>0x0012</td>
      <td>2 (word)</td>
      <td>Formation button 3</td>
    </tr>
    <tr>
      <td>0x0014</td>
      <td>2 (word)</td>
      <td>Formation button 4</td>
    </tr>
    <tr>
      <td>0x0016</td>
      <td>2 (word)</td>
      <td>Formation button 5</td>
    </tr>
    <tr>
      <td>0x0018</td>
      <td>4 (dword)</td>
      <td>Party gold</td>
    </tr>
    <tr>
      <td>0x001c</td>
      <td>2 (dword)</td>
      <td>Count of <a href="#GAMEV2_0_NPC">NPC structs for party members</a> (without Protagonist)</td>
    </tr>
    <tr>
      <td>0x001e</td>
      <td>2 (word)</td>
      <td>Weather bitfield:
        <div class="indent1">
          bit0: Rain<br />
          bit1: Snow<br />
        </div>
        <br />
        Higher bits determine the density and intensity of the weather.
      </td>
    </tr>
    <tr> 
      <td>0x0020</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#GAMEV2_0_NPC">NPC structs for party members</a>.</td>
    </tr>
    <tr>
      <td>0x0024</td>
      <td>4 (dword)</td>
      <td>Count of <a href="#GAMEV2_0_NPC">NPC structs for party members</a> (with Protagonist)</td>
    </tr>
    <tr>
      <td>0x0028</td>
      <td>4 (dword)</td>
      <td><div class="unknown">Unknown</div></td>
    </tr>
    <tr>
      <td>0x002c</td>
      <td>4 (dword)</td>
      <td><div class="unknown">Unknown</div></td>
    </tr>
    <tr>
      <td>0x0030</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#GAMEV2_0_NPC">NPC structs for non-party members</a>.</td>
    </tr>
    <tr>
      <td>0x0034</td>
      <td>4 (dword)</td>
      <td>Count of <a href="#GAMEV2_0_NPC">NPC structs for non-party members</a>.</td>
    </tr>
    <tr>
      <td>0x0038</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#GAMEV2_0_Variable">GLOBAL namespace variables </a> (i.e. non-local plot variables)</td>
    </tr>
    <tr>
      <td>0x003c</td>
      <td>4 (dword)</td>
      <td>Count of <a href="#GAMEV2_0_Variable">GLOBAL namespace variables</a>.</td>
    </tr>
    <tr>
      <td>0x0040</td>
      <td>8 (resref)</td>
      <td>Main area</td>
    </tr>
    <tr>
      <td>0x0048</td>
      <td>4 (dword)</td>
      <td><span class="unknown">Unknown</span></td>
    </tr>
    <tr>
      <td>0x004c</td>
      <td>4 (dword)</td>
      <td>Count of <a href="#GAMEV2_0_Journal"> journal entries </a></td>
    </tr>
    <tr>
      <td>0x0050</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#GAMEV2_0_Journal"> journal entries </a></td>
    </tr>
    <tr>
      <td>0x0054</td>
      <td>4 (dword)</td>
      <td>Party Reputation (*10)</td>
    </tr>
    <tr>
      <td>0x0058</td>
      <td>8 (resref)</td>
      <td>Current area</td>
    </tr>
    <tr>
      <td>0x0060</td>
      <td>4 (dword)</td>
      <td>Bitmask controlling sizing of the text panel. Only bits 1 and 2 are used: <br />
      <div class="indent1">
        bit 0: (0) Party AI disabled / (1) Party AI enabled<br />
        bit 1: Text window size*<br />
        bit 2: Text window size*<br />
        bit 3: <span class="unknown">Unknown</span><br />
        bit 4: (0) Show GUI / (1) Hide GUI <br />
        bit 5: (0) Show options panel / (1) Hide options panel<br />
        bit 6: (0) Show portraits panel / (1) Hide portraits panel<br />
        bit 7: (0) Hide automap notes / (1) Show automap notes<br />
      </div>
      <br />
        * These bits control the text window size. The bits relate to the size as follows:<br />
        &nbsp; 00 = Small<br />
        &nbsp; 01 = Medium<br />
        &nbsp; 10 = Unused<br />
        &nbsp; 11 = Large<br />
      <br />
      NB. Not all engines use all bits.<br />
      </td>
    </tr>     
    <tr>
      <td>0x0064</td>
      <td>4 (dword)</td>
      <td><span class="unknown">Unknown</span></td>
    </tr>
    <tr>
      <td>0x0068</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#GAMEV2_0_Familiar"> Familiar info </a></td>
    </tr>
    <tr>
      <td>0x006c</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#GAMEV2_0_Stored"> Stored Locations<a/></td>
    </tr>
    <tr>
      <td>0x0070</td>
      <td>4 (dword)</td>
      <td>Count of <a href="#GAMEV2_0_Stored"> Stored Locations<a/></td>
    </tr>
    <tr>
      <td>0x0074</td>
      <td>4 (dword)</td>
      <td>Game Time (real seconds)</td>
    </tr>
    <tr>
      <td>0x0078</td>
      <td>4 (dword)</td>
      <td><span class="unknown">Offset to unknown section</span></td>
    </tr>
    <tr>
      <td>0x007c</td>
      <td>4 (dword)</td>
      <td><span class="unknown">Count of unknown section</span></td>
    </tr>
    <tr>
      <td>0x0080</td>
      <td>52 (bytes)</td>
      <td><span class="unknown">Unknown</span></td>
    </tr>
  </tbody>
</table>
</div>
<br />
<br />

<div class="fileheader"><a name="GAMEV2_0_NPC">GAME V2.0 NPCs (both in-party and out-of-party NPCs)</a></div>
<br />
<div class="indent1">
This structure represents data about any character who can possibly be in your party.<br />
<br />
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (datatype)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>2 (word)</td>
      <td>Character selection (0 = Not selected, 1 = Selected, 0x8000 = Dead</td>
    </tr>
    <tr>
      <td>0x0002</td>
      <td>2 (word)</td>
      <td>Party order (0x0-0x5 = PlayerXFill, 0xFFFF = not in party)</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>4 (dword)</td>
      <td>Offset from start of file to CRE resource data for this character.</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>4 (dword)</td>
      <td>Size of CRE resource data for this character.</td>
    </tr>
    <tr>
      <td>0x000c</td>
      <td>8 (bytes)</td>
      <td>Character Name</td>
    </tr>
    <tr>
      <td>0x0014</td>
      <td>4 (dword)</td>
      <td>Orientation</td>
    </tr>
    <tr>
      <td>0x0018</td>
      <td>8 (resref)</td>
      <td>Characters current area</td>
    </tr>
    <tr>
      <td>0x0020</td>
      <td>2 (word)</td>
      <td>Current X coordinate of character</td>
    </tr>
    <tr>
      <td>0x0022</td>
      <td>2 (word)</td>
      <td>Current Y coordinate of character</td>
    </tr>
    <tr>
      <td>0x0024</td>
      <td>2 (word)</td>
      <td>X coordinate of viewing rectangle</td>
    </tr>
    <tr>
      <td>0x0026</td>
      <td>2 (word)</td>
      <td>Y coordinate of viewing rectangle</td>
    </tr>
    <tr>
      <td>0x0028</td>
      <td>2 (word)</td>
      <td>Modal action</td>
    </tr>
    <tr>
      <td>0x002a</td>
      <td>2 (word)</td>
      <td>Hapiness value</td>
    </tr>
    <tr>
      <td>0x002c</td>
      <td>96 (bytes)</td>
      <td><span class="unknown">Unknown</span></td>
    </tr>
    <tr>
      <td>0x008c</td>
      <td>2 (word)</td>
      <td>Index into slots.ids for Quick Weapon 1 (0xFFFF = none)</td>
    </tr>
    <tr>
      <td>0x008e</td>
      <td>2 (word)</td>
      <td>Index into slots.ids for Quick Weapon 2 (0xFFFF = none)</td>
    </tr>
    <tr>
      <td>0x0090</td>
      <td>2 (word)</td>
      <td>Index into slots.ids for Quick Weapon 3 (0xFFFF = none)</td>
    </tr>
    <tr>
      <td>0x0092</td>
      <td>2 (word)</td>
      <td>Index into slots.ids for Quick Weapon 4 (0xFFFF = none)</td>
    </tr>
    <tr>
      <td>0x0094</td>
      <td>2 (word)</td>
      <td>Quick Weapon 1 slot enabled</td>
    </tr>
    <tr>
      <td>0x0096</td>
      <td>2 (word)</td>
      <td>Quick Weapon 2 slot enabled</td>
    </tr>
    <tr>
      <td>0x0098</td>
      <td>2 (word)</td>
      <td>Quick Weapon 3 slot enabled</td>
    </tr>
    <tr>
      <td>0x009a</td>
      <td>2 (word)</td>
      <td>Quick Weapon 4 slot enabled</td>
    </tr>
    <tr>
      <td>0x009c</td>
      <td>8 (resref)</td>
      <td>Quick Spell 1 resouce</td>
    </tr>
    <tr>
      <td>0x00a4</td>
      <td>8 (resref)</td>
      <td>Quick Spell 2 resouce</td>
    </tr>
    <tr>
      <td>0x00ac</td>
      <td>8 (resref)</td>
      <td>Quick Spell 3 resouce</td>
    </tr>
    <tr>
      <td>0x00b4</td>
      <td>2 (word)</td>
      <td>Index into slots.ids for Quick Item 1 (0xFFFF = none)</td>
    </tr>
    <tr>
      <td>0x00b6</td>
      <td>2 (word)</td>
      <td>Index into slots.ids for Quick Item 2 (0xFFFF = none)</td>
    </tr>
    <tr>
      <td>0x00b8</td>
      <td>2 (word)</td>
      <td>Index into slots.ids for Quick Item 3 (0xFFFF = none)</td>
    </tr>
    <tr>
      <td>0x00ba</td>
      <td>2 (word)</td>
      <td>Quick Item 1 slot enabled</td>
    </tr>
    <tr>
      <td>0x00bc</td>
      <td>2 (word)</td>
      <td>Quick Item 2 slot enabled</td>
    </tr>
    <tr>
      <td>0x00be</td>
      <td>2 (word)</td>
      <td>Quick Item 3 slot enabled</td>
    </tr>
    <tr>
      <td>0x00c0</td>
      <td>32 (bytes)</td>
      <td>Name</td>
    </tr>
    <tr>
      <td>0x00e0</td>
      <td>4 (dword)</td>
      <td>Talkcount</td>
    </tr>
    <tr>
      <td>0x00e4</td>
      <td>116 bytes </td>
      <td><a href="#GAMEV2_0_Stats">Character Stats </a> for this character</td>
    </tr>
    <tr>
      <td>0x0158</td>
      <td>8 bytes</td>
      <td>Voice Set</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<br />
<div class="fileheader"><a name="GAMEV2_0_Stats">GAME V2.0 Character stats</a></div>
<div class="indent1">
<br />
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (data type)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>4 (strref)</td>
      <td>&quot;Most powerful vanquished&quot; - Name </td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>4 (dword)</td>
      <td>&quot;Most powerful vanquished&quot; - XP Reward</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>4 (dword)</td>
      <td>Time in party (1/15 seconds)</td>
    </tr>
    <tr>
      <td>0x000c</td>
      <td>4 (dword)</td>
      <td>Time Joined (1/15 seconds)</td>
    </tr>
    <tr>
      <td>0x0010</td>
      <td>2 (word)</td>
      <td>Party member (0 = Not in party, 1 = In party)</td>
    </tr>
    <tr>
      <td>0x0010</td>
      <td>2 (word)</td>
      <td><span class="unknown">Unknown</unknown></td>
    </tr>
    <tr>
      <td>0x0014</td>
      <td>4 (dword)</td>
      <td>Kills - XP Gained (chapter)</td>
    </tr>
    <tr>
      <td>0x0018</td>
      <td>4 (dword)</td>
      <td>Kills - Number (chapter)</td>
    </tr>
    <tr>
      <td>0x001c</td>
      <td>4 (dword)</td>
      <td>Kills -  XP (game)</td>
    </tr>
    <tr>
      <td>0x0020</td>
      <td>4 (dword)</td>
      <td>Kills - number (game)</td>
    </tr>
    <tr>
      <td>0x0024</td>
      <td>4*8 (resref array)</td>
      <td>Favourite spells</td>
    </tr>
    <tr>
      <td>0x0044</td>
      <td>4*2 (word array)</td>
      <td>Favourite spell count</td>
    </tr>
    <tr>
      <td>0x004c</td>
      <td>4*8 (resref array)</td>
      <td>Favourite weapons</td>
    </tr>
    <tr>
      <td>0x006c</td>
      <td>4*2 (word)</td>
      <td>Favourite weapon time (time equipped in combat - 1/15 seconds)</td>
    </tr>
  </tbody>
</table>
</div>

<br />
<div class="fileheader"><a name="GAMEV2_0_Variable">GAME V2.0 Game variables (plot variables)</a></div>
<div class="indent1">
<br />
These structures represent variables with a textual name an an integer value.
Most variables are in some namespace or other -- a namespace being a 6-byte
character string. Most variables go in the &quot;GLOBAL&quot; namespace, though
some go in area-specific namespaces.<br />
<br />
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (data type)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>32 (char array)</td>
      <td>Variable name</td>
    </tr>
    <tr class="unk">
      <td>0x0020</td>
      <td>8 (bytes)</td>
      <td><span class="unknown">Unknown</span></td>
    </tr>
    <tr>
      <td>0x0028</td>
      <td>4 (dword)</td>
      <td>Variable value</td>
    </tr>
    <tr>
      <td>0x002c</td>
      <td>40 (bytes)</td>
      <td><span class="unknown">Unknown</span></td>
    </tr>
  </tbody>
</table>
</div>

<br />
<div class="fileheader"><a name="GAMEV2_0_Journal">GAME V2.0 Journal entries</a></div>
<div class="indent1">
<br />
Every time some text is entered into your journal, its strref is added to
this table, along with the time (in seconds! not in 12-second increments, as the
earlier game time in this file), as well as the &quot;current chapter&quot;.<br />
<br />
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (data type)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>4 (strref)</td>
      <td>Journal text</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>4 (dword)</td>
      <td>Time (seconds)</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>4 (dword)</td>
      <td>Current chapter number</td>
    </tr>
    <tr>
      <td>0x000C</td>
      <td>1 (byte)</td>
      <td><span class="unknown">Unknown</span></td>
    </tr>
    <tr>
      <td>0x000D</td>
      <td>1 (byte)</td>
      <td>Journal section:
        <div class="indent1">
          bit 0: Quests<br />
          bit 1: Competed quest<br />
          bit 2: Journal Info<br />
        </div>
        <br />
        NB. If no bits are set, the entry is a user-note.
      </td>
    </tr>
      <tr>
      <td>0x000E</td>
      <td>1 (byte)</td>
      <td>Location flag (0x1F = external TOT/TOH, 0xFF = internal TLK) </td>
    </tr>
  </tbody>
</table>
</div>

<br />
<div class="fileheader"><a name="GAMEV2_0_Familiar">GAME V2.0 Familiar info</a></div>
<div class="indent1">
<br />
Each alignment has a familiar, represented by a cre file. The alignment -> cre file mapping is contained here.<br />
<br />
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (data type)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>8 (resref)</td>
      <td>Lawful Good Familiar</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>8 (resref)</td>
      <td>Lawful Neutral Familiar</td>
    </tr>
    <tr>
      <td>0x0010</td>
      <td>8 (resref)</td>
      <td>Lawful Evil Familiar</td>
    </tr>
    <tr>
      <td>0x0018</td>
      <td>8 (resref)</td>
      <td>Neutral Good Familiar</td>
    </tr>
    <tr>
      <td>0x0020</td>
      <td>8 (resref)</td>
      <td>Neutral Familiar</td>
    </tr>
    <tr>
      <td>0x0028</td>
      <td>8 (resref)</td>
      <td>Neutral Evil Familiar</td>
    </tr>
    <tr>
      <td>0x0030</td>
      <td>8 (resref)</td>
      <td>Chaotic Good Familiar</td>
    </tr>
    <tr>
      <td>0x0038</td>
      <td>8 (resref)</td>
      <td>Chaotic Neutral Familiar</td>
    </tr>
    <tr>
      <td>0x0040</td>
      <td>8 (resref)</td>
      <td>Chaotic Evil Familiar</td>
    </tr>
    <tr>
      <td>0x0048</td>
      <td>328 (bytes)</td>
      <td><span class="unknown">Unknown</span></td>
    </tr>
  </tbody>
</table>
</div>

<br />
<div class="fileheader"><a name="GAMEV2_0_Stored">GAME V2.0 Stored Locations info</a></div>
<div class="indent1">
<br />
This struct is filled by the StorePartyLocations() action and cleared by the RestorePartyLocations() action.<br />
<br />
<table border="1" width="98%">
  <colgroup>
    <col width="5%">
    <col width="12%">
    <col width="*">
  </colgroup>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Size (data type)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>8 (resref)</td>
      <td>Area</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>2 (word)</td>
      <td>X coordinate</td>
    </tr>
    <tr>
      <td>0x000a</td>
      <td>2 (word)</td>
      <td>Y coordinate</td>
    </tr>
  </tbody>
</table>
</body>
</html>