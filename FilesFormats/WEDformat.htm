<html>


<!-- Mirrored from www25.brinkster.com by HTTrack Website Copier/3.x [XR,YP'2001] -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
<meta http-equiv="Content-Language" content="en-us">
<link href="ManverusStyle.css" type=text/css rel=stylesheet>
<title>IE File Formats</title>
</head>

<body>

<h1 align="center">WED file format</h1>
<table border="1" width="610">
  <tr>
    <td width="28%">FileExtension :</td>
    <td width="72%">WED</td>
  </tr>
  <tr>
    <td width="28%">Content :</td>
    <td width="72%">Description of WED V.1.3</td>
  </tr>
  <tr>
    <td width="28%">History :</td>
    <td width="72%">File done by IEFFHP</td>
  </tr>
  <tr>
    <td width="28%">Update :</td>
    <td width="72%">Manveru (13.10.2001)</td>
  </tr>
  <tr>
    <td width="28%">&nbsp;</td>
    <td width="72%">Special thanks for TheoTeamBG for fruitful cooperation in
      breaking down unknown issues of handling of these files.&nbsp;(last update
      25.11.01)</td>
  </tr>
</table>
<h2>Description</h2>
<p>This is a pretty meaty file as far as content goes. I believe I have most of
it pinned down, but not all of it. Basically, it ties together the physical
representation of the terrain with the tilesets. This is essentially, the map,
without its containers, actors, and items. In this file is a representation of
all the walls and doors, as well, grouped together by contiguity.</p>
<h2><a name="formWED_Versions">WED file versions</a></h2>
<ul>
  <li><a href="#formWEDV1_3">V1.3: Baldur's Gate, Planescape: Torment, Icewind
    Dale, Baldur's Gate 2</a></li>
</ul>
<h2 class="frmhead"><a name="formWEDV1_3">WED V1.3</a></h2>
<p>An area is drawn in tiles. We will refer to each location into which a tile
can be drawn as a tile cell. The tile cells are numbered starting from 0 at the
top-left corner, increasing by one as you move to the right. A tile cell's index
is computed as <code>y*width+x</code>. Several overlays are drawn. Overlay 0 is
drawn first, and if needed, other overlays are drawn. So, a tile cell's index is
looked up in the tilemap structures. These give a &quot;tile lookup index&quot;,
which is an index into the tile indices lookup table. The tile indices lookup
table gives the index into the actual tileset, at which point, the tile is
drawn. Next, if the tilemap structure indicates any overlays need to be drawn,
the process is repeated using the appropriate overlay, along with its associated
tilemap and tile indices. At least as of this version, the tiles in the tilesets
appear to be hardcoded at 64x64, and the cells in the search map are, I believe,
hardcoded at 16x16 pixels.</p>
<p>Overall structure:</p>
<ul>
  <li><a href="#formWEDV1_3_Header">Header</a>
  <li><a href="#formWEDV1_3_Overlay">Overlays</a>
  <li><a href="#formWEDV1_3_SecHeader">Secondary header</a>
  <li><a href="#formWEDV1_3_Doors">Doors</a>
  <li><a href="#formWEDV1_3_TileMap">Tilemap structures</a>
  <li><a href="#formWEDV1_3_DoorTiles">Door tile cell indices</a>
  <li><a href="#formWEDV1_3_TileIndices">Tile indices (lookup table)</a>
  <li><a href="#formWEDV1_3_WallGroup">Wall groups</a>
  <li><a href="#formWEDV1_3_Polygon">Polygons</a>
  <li><a href="#formWEDV1_3_PolygonIndices">Polygon indices (lookup table)</a>
  <li><a href="#formWEDV1_3_Vertices">Vertices</a></li>
</ul>
<h4 class="reshead"><a name="formWEDV1_3_Header">WED V1.3 Header</a></h4>
<table border="1" class="tbl3" width="98%">
  <colgroup>
    <col class="col1" width="5%">
    <col class="col2" width="12%">
    <col class="col3" width="*">
  </colgroup>
  <thead>
    <tr>
      <th><font color="#000000">Offset</font></th>
      <th><font color="#000000">Size (data type)</font></th>
      <th><font color="#000000">Description</font></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>4 (char array)</td>
      <td>Signature ('WED ')</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>4 (char array)</td>
      <td>Version ('V1.3')</td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>4 (dword)</td>
      <td>Number of <a href="#formWEDV1_3_Overlay">overlays</a> (including the
        base layer)</td>
    </tr>
    <tr>
      <td>0x000c</td>
      <td>4 (dword)</td>
      <td>Number of <a href="#formWEDV1_3_Doors">doors</a></td>
    </tr>
    <tr>
      <td>0x0010</td>
      <td>4 (dword)</td>
      <td>Offset (from start of file) to <a href="#formWEDV1_3_Overlay">overlays</a></td>
    </tr>
    <tr>
      <td>0x0014</td>
      <td>4 (dword)</td>
      <td>Offset (from start of file) to <a href="#formWEDV1_3_SecHeader">secondary
        header</a></td>
    </tr>
    <tr>
      <td>0x0018</td>
      <td>4 (dword)</td>
      <td>Offset (from start of file) to <a href="#formWEDV1_3_Doors">doors</a></td>
    </tr>
    <tr>
      <td>0x001c</td>
      <td>4 (dword)</td>
      <td>Offset (from start of file) to <a href="#formWEDV1_3_DoorTiles">door
        tile cell indices</a></td>
    </tr>
  </tbody>
</table>
<h4 class="reshead"><a name="formWEDV1_3_Overlay">WED V1.3 Overlays</a></h4>
<p>Each overlay is represented by a tileset. These overlays will each cover a
part of the map. Which parts of the map have which overlays is coded for in the <a href="#formWEDV1_3_TileMap">tilemap</a>
section. For instance, bodies of water are typically done as overlays in BG. (WTRIV
is a tileset used for rivers, WTLAKE is a tileset used for lakes.). <a href="../General/Overlays.htm"><font color="#FF0000">Here
is the list of some useful TIS filenames that may be used .</font></a><table border="1" class="tbl3" width="98%">
  <colgroup>
    <col class="col1" width="5%">
    <col class="col2" width="12%">
    <col class="col3" width="*">
  </colgroup>
  <thead>
    <tr>
      <th><font color="#000000">Offset</font></th>
      <th><font color="#000000">Size (data type)</font></th>
      <th><font color="#000000">Description</font></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>2 (word)</td>
      <td>Width (in tiles)</td>
    </tr>
    <tr>
      <td>0x0002</td>
      <td>2 (word)</td>
      <td>Height (in tiles)</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>8 (resref)</td>
      <td>Name of <a href="TISformat.htm"><font color="#FF0000"> tileset (resource type 0x3eb)</font></a></td>
    </tr>
    <tr class="unk">
      <td><font color="#000099">0x000c</font></td>
      <td><font color="#000099">4 (unknown)</font></td>
      <td><font color="#000099">Unknown</font></td>
    </tr>
    <tr>
      <td>0x0010</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#formWEDV1_3_TileMap">tilemap</a> for this overlay</td>
    </tr>
    <tr>
      <td>0x0014</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#formWEDV1_3_TileIndices">tile index lookup</a> for
        this overlay</td>
    </tr>
  </tbody>
</table>
<h4 class="reshead"><a name="formWEDV1_3_SecHeader">WED V1.3 Secondary header</a></h4>
<p>Consider this a &quot;secondary header&quot; of sorts. It holds more offsets.
This probably sprang out of incompatibilities between earlier internal versions
of the WED file (V1.0, V1.1, and V1.2 come to mind) and the current version.</p>
<table border="1" class="tbl3" width="98%">
  <colgroup>
    <col class="col1" width="5%">
    <col class="col2" width="12%">
    <col class="col3" width="*">
  </colgroup>
  <thead>
    <tr>
      <th><font color="#000000">Offset</font></th>
      <th><font color="#000000">Size (data type)</font></th>
      <th><font color="#000000">Description</font></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>4 (dword)</td>
      <td>Number of <a href="#formWEDV1_3_Polygon">polygons</a> used to
        represent walls</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#formWEDV1_3_Polygon">polygons</a></td>
    </tr>
    <tr>
      <td>0x0008</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#formWEDV1_3_Vertices">Vertices</a></td>
    </tr>
    <tr>
      <td>0x000c</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#formWEDV1_3_WallGroup">Wall groups</a></td>
    </tr>
    <tr>
      <td>0x0010</td>
      <td>4 (dword)</td>
      <td>Offset to <a href="#formWEDV1_3_PolygonIndices">Polygon indices lookup
        table</a></td>
    </tr>
  </tbody>
</table>
<h4 class="reshead"><a name="formWEDV1_3_Door">WED V1.3 Doors</a></h4>
<p>All the physical doors on a map are represented by this sort of structure.
(If, that is, they can be opened.) Really, this doesn't have to be doors, but
just anything which &quot;acts like&quot; a door -- i.e. has an opened and
closed state, and which optionally blocks certain squares from being reached
when closed, and doesn't block them when open. The <a href="#formWED_V1_3_DoorTiles">door
tile cells</a> for a given door are those cells which are impeded, and whose
graphics change when this door is closed. See the <a href="#formWED_V1_3_DoorTiles">door
tile cell indices</a> section for details.</p>
<table border="1" class="tbl3" width="98%">
  <colgroup>
    <col class="col1" width="5%">
    <col class="col2" width="12%">
    <col class="col3" width="*">
  </colgroup>
  <thead>
    <tr>
      <th><font color="#000000">Offset</font></th>
      <th><font color="#000000">Size (data type)</font></th>
      <th><font color="#000000">Description</font></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>8 (char array)</td>
      <td>Name of door (matched on in AREA file?)</td>
    </tr>
    <tr class="unc">
      <td>0x0008</td>
      <td>2 (word)</td>
      <td><font color="#000099">Unknown... Open/closed? (1==closed)</font></td>
    </tr>
    <tr>
      <td>0x000a</td>
      <td>2 (word)</td>
      <td>First <a href="#formWEDV1_3_DoorTiles">door tile cell</a> index</td>
    </tr>
    <tr>
      <td>0x000c</td>
      <td>2 (word)</td>
      <td>Count of <a href="#formWEDV1_3_DoorTiles">door tile cells</a> for this
        door</td>
    </tr>
    <tr>
      <td>0x000e</td>
      <td>2 (word)</td>
      <td>Count of <a href="#formWEDV1_3_Polygon">polygons used to represent
        door in &quot;door open&quot; state</a></td>
    </tr>
    <tr>
      <td>0x0010</td>
      <td>2 (word)</td>
      <td>Count of <a href="#formWEDV1_3_Polygon">polygons used to represent
        door in &quot;door closed&quot; state</a></td>
    </tr>
    <tr>
      <td>0x0012</td>
      <td>4 (dword)</td>
      <td>Offset from start of file to <a href="#formWEDV1_3_Polygon">polygons</a>
        used to represent door in &quot;door open&quot; state</td>
    </tr>
    <tr>
      <td>0x0016</td>
      <td>4 (dword)</td>
      <td>Offset from start of file to <a href="#formWEDV1_3_Polygon">polygons</a>
        used to represent door in &quot;door closed&quot; state</td>
    </tr>
  </tbody>
</table>
<h4 class="reshead"><a name="formWEDV1_3_TileMap">WED V1.3 Tilemap structures</a></h4>
<p>For each &quot;tile cell&quot; in a overlay, there is one tilemap structure.
These structures tell us which tile(s) from the tileset resource are to be used
for this tile cell. Each tile cell must have one tileset resource; those which
are referenced by the <a href="#formWEDV1_3_DoorTiles">door tile cells</a> of a
door must have 2 -- one for the &quot;open&quot; state, and one for the
&quot;closed&quot; state. Some tile cells are animated, and they will use a
range of tile indices from the <a href="#formWEDV1_3_TileIndices">tile indices
lookup table.</a></p>
<table border="1" class="tbl3" width="98%">
  <colgroup>
    <col class="col1" width="5%">
    <col class="col2" width="12%">
    <col class="col3" width="*">
  </colgroup>
  <thead>
    <tr>
      <th><font color="#000000">Offset</font></th>
      <th><font color="#000000">Size (data type)</font></th>
      <th><font color="#000000">Description</font></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>2 (word)</td>
      <td>Start index in <a href="#formWEDV1_3_TileIndices">tile index lookup
        table</a> of primary (default) tile</td>
    </tr>
    <tr>
      <td>0x0002</td>
      <td>2 (word)</td>
      <td>Count of tiles in <a href="#formWEDV1_3_TileIndices">tile index lookup
        table</a> for primary (default) tile</td>
    </tr>
    <tr>
      <td>0x0004</td>
      <td>2 (word)</td>
      <td>Index from <a href="TISformat.htm"><font color="#FF0000">TIS file</font></a>
        of secondary (alternate) tile (i.e. tile for closed state, if tile has an
        open/closed state) and also for overlays indication (tiles with marked
        overlay area, by &quot;green&quot; color)</td>
    </tr>
    <tr>
      <td>0x0006</td>
      <td>1 (byte)</td>
      <td>The upper 7 bits of this byte are a bitmap indicating which of the
        overlays are to be drawn. The 0th overlay (the base layer) is always
        drawn.</td>
    </tr>
    <tr class="unk">
      <td>0x0007</td>
      <td>3 (bytes)</td>
      <td><font color="#000099">These bytes are not understood...</font></td>
    </tr>
  </tbody>
</table>
<h4 class="reshead"><a name="formWEDV1_3_DoorTiles">WED V1.3 Door tile cells</a></h4>
<p>Each door has associated to it a range of tile indices in this array. When
the door is opened or closed, all the tiles whose indices are contained in the
specified region of this array, have their state toggled. This means that the
tile becomes (un)passable and that the tile graphic is switched between the
default and alternate tile graphic. (In short, these are indices into the <a href="#formWED_V1_3_TileMap">tilemap</a>
array.)</p>
<h4 class="reshead"><a name="formWEDV1_3_TileIndices">WED V1.3 Tile index lookup
table</a></h4>
<p>The '<a href="#formWEDV1_3_TileMap">tile map</a>' structures reference
indices into this table. The 'tile counts' in the <a href="#formWED_V1_3_TileMap">tilemap</a>
table are counts of indices in this table. This maps tile indices from the WED
tile indices into the appropriate tile indices for the particular tileset file
which the overlay in question references. This, then, is just a big array of
little-endian 16-bit words.</p>
<h4 class="reshead"><a name="formWEDV1_3_WallGroup">WED V1.3 Wall groups</a></h4>
<p>Representations of continuous walls and doors need to be stored to determine
where the characters can and cannot walk (actually where creatures animations
are shaded and where they are not, since access to the certain places on map is
determined by search auxiliary map of area). This is achieved by creating <a href="#formWEDV1_3_Polygon">polygons</a>
for walls and grouping them together by connectivity. Doors in their open/closed
state can be formed of an arbitrary number of <a href="#formWEDV1_3_Polygon">polygons</a>.
For instance, a double door could be one <a href="#formWEDV1_3_Polygon">polygon</a>
when it is closed, and two when it is open. These <a href="#formWEDV1_3_Polygon">wall
groups</a> are sets of indices in the <a href="#formWEDV1_3_PolygonIndices">polygon
indices lookup table</a>, which in turn point into the <a href="#formWEDV1_3_Polygon">polygon
table.</a></p>
<p>One thing worth remembering is that one wall group has the following
dimensions : 10 tiles * 7.5 tiles, thus all areas should have the according to
the background overlay amount of wall groups sections stored here i.e. area with
dimensions 80*60 tiles should have 64 wall groups.<a href="../General/Wallgroups.htm"><font color="#FF0000">
For more details look here.</font></a></p>
<table border="1" class="tbl3" width="98%">
  <colgroup>
    <col class="col1" width="5%">
    <col class="col2" width="12%">
    <col class="col3" width="*">
  </colgroup>
  <thead>
    <tr>
      <th><font color="#000000">Offset</font></th>
      <th><font color="#000000">Size (datatype)</font></th>
      <th><font color="#000000">Description</font></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>2 (word)</td>
      <td>Start <a href="#formWEDV1_3_PolygonIndices">polygon index</a></td>
    </tr>
    <tr>
      <td>0x0002</td>
      <td>2 (word)</td>
      <td><a href="#formWEDV1_3_PolygonIndices">Polygon index count</a></td>
    </tr>
  </tbody>
</table>
<h4 class="reshead"><a name="formWEDV1_3_Polygon">WED V1.3 Polygons</a></h4>
<p>A polygon is a list of vertices, along with some state information I haven't
yet deciphered, and a minimum bounding box.</p>
<p>What is order of these vertices that create polygons&nbsp; ?</p>
<p>For doors walls they have to be clockwise and have to be saved starting with the rightmost vertex first.
If there are two or more vertex on the same rightmost vertical line you have to start with the one at the
lowest point.</p>
<p>With normal walls the most lowest vertex has to be the first and it does not really matter if it's clockwise or counter-clockwise as far as I know.</p>
<table border="1" class="tbl3" width="509">
  <colgroup>
    <col class="col1" width="5%">
    <col class="col2" width="12%">
    <col class="col3" width="*">
  </colgroup>
  <thead>
    <tr>
      <th width="48"><font color="#000000">Offset</font></th>
      <th width="104"><font color="#000000">Size (data type)</font></th>
      <th width="335"><font color="#000000">Description</font></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td width="48">0x0000</td>
      <td width="104">4 (dword)</td>
      <td width="335">Starting vertex index</td>
    </tr>
    <tr>
      <td width="48">0x0004</td>
      <td width="104">4 (dword)</td>
      <td width="335">Count of vertices</td>
    </tr>
    <tr>
      <td width="48">0x0008</td>
      <td width="104">1 (unsigned byte)</td>
      <td width="335">Indicates whether this polygon is a polygon or a hole (i.e. whether it
        is a section of impassability, or one of passability.)
        <p>The default is that wall shades animations from both sides - it is
        modified by flag.</p>
        <p>Here we have 8 bit flag :</p>
        <ul>
          <li>Bit 0 : If set to 1 then the NPC/creature/PC appears to be behind
            wall if his location point is inside wall polygon boundaries. If the
            character location is &quot;beneath&quot; the wall polygon then the
            character's animation is shown in front of the wall and it is not
            shaded.</li>
          <li>Bit 1 : If set to 1 this disable wall appearance at all.</li>
          <li><font color="#000099">Bit 2 : There appears errors and game
            crushes ( Assertion failed in ChVidPoly.cpp, line 523) , however
            there are some condition when it works ok (used in AR0300 in BG2)
            but exact results are unknown at the moment.</font></li>
          <li><font color="#000099">Bit 3 : Also used in game areas, in many
            places, but at
            first glance it doesn't seem to do anything.</font></li>
          <li><font color="#000099">Bit 4 : unknown, unused ?&nbsp;</font></li>
          <li><font color="#000099">Bit 5 : unknown, unused ?&nbsp;</font></li>
          <li><font color="#000099">Bit 6 : unknown, unused ?&nbsp;</font></li>
          <li><font color="#000099">Bit 7 : unknown, I have seen this in doors
            walls flags.&nbsp;</font></li>
        </ul>
      </td>
    </tr>
    <tr class="unk">
      <td width="48"><font color="#000099">0x0009</font></td>
      <td width="104"><font color="#000099">1 (unknown)</font></td>
      <td width="335"><font color="#000099">Unknown... usually value FF</font></td>
    </tr>
    <tr>
      <td width="48">0x000a</td>
      <td width="104">2 (word)</td>
      <td width="335">Min X coord of bounding box</td>
    </tr>
    <tr>
      <td width="48">0x000c</td>
      <td width="104">2 (word)</td>
      <td width="335">Max X coord of bounding box</td>
    </tr>
    <tr>
      <td width="48">0x000e</td>
      <td width="104">2 (word)</td>
      <td width="335">Min Y coord of bounding box</td>
    </tr>
    <tr>
      <td width="48">0x0010</td>
      <td width="104">2 (word)</td>
      <td width="335">Max Y coord of bounding box</td>
    </tr>
  </tbody>
</table>
<h4 class="reshead"><a name="formWEDV1_3_PolygonIndices">WED V1.3 Polygon index
lookup table</a></h4>
<p>Like all the lookup tables in these files, this maps a (start,count) pair (in
this case, from the <a href="#formWEDV1_3_WallGroup">wall group table</a>) into
a set of polygon indices (from the <a href="#formWEDV1_3_Polygon">polygon table</a>).
This is essentially a table of little-endian 16-bit integers which are indices
into the polygon table.</p>
<h4 class="reshead"><a name="formWEDV1_3_Vertices">WED V1.3 Vertices</a></h4>
<p>This is a table of (x,y) pairs of vertices. Each x and y is, again, a little-endian
16-bit integer, embodying an onscreen coordinate.</p>
<table border="1" class="tbl3" width="98%">
  <colgroup>
    <col class="col1" width="5%">
    <col class="col2" width="12%">
    <col class="col3" width="*">
  </colgroup>
  <thead>
    <tr>
      <th><font color="#000000">Offset</font></th>
      <th><font color="#000000">Size (data type)</font></th>
      <th><font color="#000000">Description</font></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0x0000</td>
      <td>2 (word)</td>
      <td>X coordinate</td>
    </tr>
    <tr>
      <td>0x0002</td>
      <td>2 (word)</td>
      <td>Y coordinate</td>
    </tr>
  </tbody>
</table></body>


<!-- Mirrored from www25.brinkster.com by HTTrack Website Copier/3.x [XR,YP'2001] -->
</html>
